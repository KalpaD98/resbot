version: "3.1" # stories-greeting.yml has greeting and continuation to booking stories for the restaurant bot
stories:

  # -------------------------------- Greet and push towards book restaurant ------------------------------- #

  - story: Greeting and bot introduction with checkpoint #1
    steps:
      - intent: greet
      - action: action_utter_greet_and_intro
      - action: action_ask_language_preference
      - intent: inform_permanent_language
      - action: action_set_permanent_language
      - action: action_utter_wanna_book
      - checkpoint: checkpoint_wanna_book_restaurant

  - story: User denies to check restaurant #2 user denies to check restaurant
    steps:
      - checkpoint: checkpoint_wanna_book_restaurant
      - intent: deny
      - action: action_utter_thank_you
      - action: action_ask_anything_else

  - story: User affirms to check restaurant - logged in #3
    steps:
      - checkpoint: checkpoint_wanna_book_restaurant
      - intent: affirm
      - slot_was_set:
          - is_authenticated: True
      - action: action_show_cuisines
      - checkpoint: checkpoint_cuisine_selection

  - story: User stops after not logged in #3b1
    steps:
      - checkpoint: checkpoint_wanna_book_restaurant
      - intent: affirm
      - slot_was_set:
          - is_authenticated: false
      - action: action_ask_registered_and_show_login_signup_quick_replies
      - checkpoint: checkpoint_user_trying_to_login_or_signup

  - story: User request restaurant after greet and intro - logged in #4
    steps:
      - checkpoint: checkpoint_wanna_book_restaurant
      - intent: request_restaurants
      - slot_was_set:
          - is_authenticated: True
      - action: action_show_cuisines
      - checkpoint: checkpoint_cuisine_selection

  - story: User stops after not logged in #4b1
    steps:
      - checkpoint: checkpoint_wanna_book_restaurant
      - intent: request_restaurants
      - slot_was_set:
          - is_authenticated: false
      - action: action_ask_registered_and_show_login_signup_quick_replies
      - checkpoint: checkpoint_user_trying_to_login_or_signup


  - story: User logs in after being prompted
    steps:
      - checkpoint: checkpoint_user_trying_to_login_or_signup
      - intent: request_login_form
      - action: login_form
      - active_loop: login_form
      - action: login_form
      - active_loop: null
      - slot_was_set:
          - requested_slot: null
      - action: action_login_user
      - action: action_show_cuisines
      - checkpoint: checkpoint_cuisine_selection

  - story: User registers and logs in after being prompted
    steps:
      - checkpoint: checkpoint_user_trying_to_login_or_signup
      - intent: request_user_registration_form
      - action: registration_form
      - active_loop: registration_form
      - action: registration_form
      - active_loop: null
      - slot_was_set:
          - requested_slot: null
      - action: action_save_user_and_complete_registration
      - action: action_show_cuisines
      - checkpoint: checkpoint_cuisine_selection

  - story: User stops after being prompted to log in or sign up
    steps:
      - checkpoint: checkpoint_user_trying_to_login_or_signup
      - intent: stop
      - action: action_clear_restaurant_booking_slots
      - action: action_utter_bye_see_you_later
